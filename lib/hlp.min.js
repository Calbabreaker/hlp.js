/* 
  The hlp.js library by Calbabreaker. 
  Free to use. GPL-3.0 
*/

if(null!=window.hlp)alert("An instance of the hlp libary is already in use!"),console.error("An instance of the hlp libary is already in use! Things will not work as expected.");else{const t={};window.hlp=t,t.FULL="FULL",t.hlp2D="hlp2D",t.hlpWEBGL="hlpWEGL",t.json="json",t.text="text",t.blob="blob",t.RGB="RGB",t.RGBA="RGBA",t.HSL="HSL",t.HSLA="HSLA",t.CENTER="center",t.LEFT="left",t.RIGHT="right",t.START="start",t.END="end",console.log("--- hlp.js ---")}hlp.Matrix=class{constructor(t=0,e=0){t instanceof Array?(this.data=t,this.rows=this.data.length,this.cols=this.data[0].length):(this.rows=t,this.cols=e,this.data=new Array(t).fill().map(()=>new Array(e).fill(0)))}static add(t,e){return new hlp.Matrix(t.rows,t.cols).add(e)}add(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,r)=>e+t.data[s][r])}if("number"==typeof t)return this.map(e=>e+t);throw new Error("Did not provide valid data for parameter toAdd!")}static sub(t,e){return new hlp.Matrix(t.rows,t.cols).sub(e)}sub(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,r)=>e-t.data[s][r])}if("number"==typeof t)return this.map(e=>e-t);throw new Error("Did not provide valid data for parameter toSub!")}static dotMult(t,e){if(t.cols!==e.rows)throw new Error("hlp.Matrix a cols must match matrix b rows!");return new hlp.Matrix(t.rows,e.cols).map((s,r,i)=>{let o=0;for(let s=0;s<t.cols;s++)o+=t.data[r][s]*e.data[s][i];return o})}static multVector(t,e){if(!(t instanceof hlp.Vector))throw new Error("vec must be a vector");if(4!=e.cols||4!=e.rows)throw new Error("matrix must have 4 cols and 4 rows!");const s=new hlp.Vector(t.x,t.y,t.z);s.x=t.x*e.data[0]+t.y*e.data[0]+t.z*e.data[0]+e.data[0],s.y=t.x*e.data[1]+t.y*e.data[1]+t.z*e.data[1]+e.data[1],s.z=t.x*e.data[2]+t.y*e.data[2]+t.z*e.data[2]+e.data[2];const r=t.x*e.data[3]+t.y*e.data[3]+t.z*e.data[3]+e.data[3];return 0!=r&&s.div(r),s}static quickInverse(t){const e=new hlp.Matrix([[t.data[0],t.data[0],t.data[0],0],[t.data[1],t.data[1],t.data[1],0],[t.data[2],t.data[2],t.data[2],0],[0,0,0,0]]);return e.set(3,0,-(t.data[0]*e.data[0]+t.data[1]*e.data[0]+t.data[2]*e.data[0])),e.set(3,1,-(t.data[0]*e.data[1]+t.data[1]*e.data[1]+t.data[2]*e.data[1])),e.set(3,2,-(t.data[0]*e.data[2]+t.data[1]*e.data[2]+t.data[2]*e.data[2])),e.set(3,3,1),e}static mult(t,e){return new hlp.Matrix(t.rows,t.cols).mult(e)}mult(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,r)=>e*t.data[s][r])}if("number"==typeof t)return this.map(e=>e*t);throw new Error("Did not provide valid data for parameter toMult!")}static div(t,e){return new hlp.Matrix(t.rows,t.cols).div(e)}div(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,r)=>e/t.data[s][r])}if("number"==typeof t)return this.map(e=>e/t);throw new Error("Did not provide valid data for parameter toDiv!")}randomize(t=0,e=1){return this.map(()=>hlp.random(t,e))}randomizeGuassian(t=0,e=1){return this.map(()=>hlp.randomGaussian(t,e))}max(){let t=0;return hlp.Matrix.map(this,e=>{e>t&&(t=e)}),t}sum(){let t=0;return hlp.Matrix.map(this,e=>t+=e),t}exp(){return this.map(hlp.exp)}floor(){return this.map(hlp.floor)}fill(t){return this.map(()=>t)}constrain(t,e){return this.map(s=>hlp.min(hlp.max(s,t),e))}softmax(){return this.sub(this.max()).exp(),this.div(this.sum())}map(t){for(let e=0;e<this.rows;e++)for(let s=0;s<this.cols;s++){const r=this.data[e][s];this.data[e][s]=t(r,e,s)}return this}static map(t,e){return new hlp.Matrix(t.rows,t.cols).map((s,r,i)=>e(t.data[r][i],r,i))}static transpose(t){return new hlp.Matrix(t.cols,t.rows).map((e,s,r)=>t.data[r][s])}log(){return console.table(this.data),this}copy(){return hlp.Matrix.map(this,t=>t)}toArray(t=!1){if(t){const t=[];return this.data.forEach(e=>t.push(...e)),t}return this.copy().data}static createFromVector(t){return new hlp.Matrix([[t.x],[t.y],[t.z],[0]])}toVector(){if(this.rows>=3)return new hlp.Vector(this.data[0][0],this.data[1][0],this.data[2][0]);throw new Error("hlp.Matrix cannot be converted to a vector!")}static createIdentity(){return new hlp.Matrix([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}static createRotationX(t){return new hlp.Matrix([[1,0,0,0],[0,hlp.cos(t),hlp.sin(t),0],[0,-hlp.sin(t),hlp.cos(t),0],[0,0,0,1]])}static createRotationY(t){return new hlp.Matrix([[hlp.cos(t),0,hlp.sin(t),0],[0,1,0,0],[-hlp.sin(t),0,hlp.cos(t),0],[0,0,0,1]])}static createRotationZ(t){return new hlp.Matrix([[hlp.cos(t),hlp.sin(t),0,0],[-hlp.sin(t),hlp.cos(t),0,0],[0,0,1,0],[0,0,0,1]])}static createTranslation(t,e,s){return new hlp.Matrix([[1,0,0,0],[0,1,0,0],[0,0,1,0],[t,e,s,1]])}static createProjectionPerspect(t,e,s,r){const i=hlp.toRadians(t);return new hlp.Matrix([[e*i,0,0,0],[0,i,0,0],[0,0,r/(r-s),1],[0,0,-r*s/(r-s),0]])}static createPointAt(t,e,s){const r=hlp.Vector.sub(e,t).normalise(),i=hlp.Vector.sub(s,hlp.Vector.mult(r,s.dotProduct(r))).normalise(),o=hlp.Vector.crossProduct(i,r);return new hlp.Matrix([[o.x,o.y,o.z],[i.x,i.y,i.z],[r.x,r.y,r.z],[t.x,t.y,t.z]])}},hlp.Vector=class{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}add(t){return t instanceof hlp.Vector?(this.x+=t.x,this.y+=t.y,this.z+=t.z):(this.x+=t,this.y+=t,this.z+=t),this}static add(t,e){return t.copy().add(e)}sub(t){return t instanceof hlp.Vector?(this.x-=t.x,this.y-=t.y,this.z-=t.z):(this.x-=t,this.y-=t,this.z-=t),this}static sub(t,e){return t.copy().sub(e)}div(t){return t instanceof hlp.Vector?(this.x/=t.x,this.y/=t.y,this.z/=t.z):(this.x/=t,this.y/=t,this.z/=t),this}static div(t,e){return t.copy().div(e)}mult(t){return t instanceof hlp.Vector?(this.x*=t.x,this.y*=t.y,this.z*=t.z):(this.x*=t,this.y*=t,this.z*=t),this}static mult(t,e){return t.copy().mult(e)}static crossProduct(t,e){const s=new hlp.Vector;return s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x,s}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new hlp.Vector(this.x,this.y,this.z)}set(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}magSq(){return this.x**2+this.y**2+this.z**2}mag(){return hlp.sqrt(this.magSq())}normalise(){const t=this.mag();return 0!==t&&this.mult(1/t),this}static normalise(t){return t.copy().normalise()}dist(t){return hlp.dist(this.x,this.y,this.z,t.x,t.y,t.z)}static dist(t,e){return t.dist(e)}setMag(t){return this.normalise().mult(t)}heading(){const t=hlp.atan2(this.y,this.x);return hlp.toDegrees(t)}rotate(t){const e=hlp.toRadians(this.heading()+t),s=this.mag();return this.x=hlp.cos(e)*s,this.y=hlp.sin(e)*s,this}rotateTo(t){const e=this.heading(),s=this.mag();return this.x=hlp.cos(e)*s,this.y=hlp.sin(e)*s,this}toString(){return`x: ${this.x}, y: ${this.y}, z: ${this.z}`}toArray(){return[this.x,this.y,this.z]}static fromAngle(t,e=1){return t=hlp.toRadians(t),new hlp.Vector(e*hlp.cos(t),e*hlp.sin(t),0)}static random2D(t=1){return hlp.Vector.fromAngle(hlp.random(0,360)).mult(t)}static intersectPlane(t,e,s,r){const i=-(e=hlp.Vector.normalise(e)).dotProduct(t),o=s.dotProduct(e),n=(-i-o)/(r.dotProduct(e)-o);return hlp.Vector.sub(r,s).mult(n).add(s)}},Object.getOwnPropertyNames(window.Math).forEach(t=>{hlp[t]=window.Math[t]}),hlp.TWO_PI=2*hlp.PI,hlp.FOUR_PI=4*hlp.PI,hlp.HALF_PI=hlp.PI/2,hlp.QUARTER_PI=hlp.PI/4,hlp._y2Guass=0,hlp._gaussianPrev=!1,hlp.map=((t,e,s,r,i)=>r+(i-r)*(t-e)/(s-e)),hlp.toRadians=(t=>t*hlp.PI/180),hlp.toDegrees=(t=>t*(180/hlp.PI)),hlp.lerp=((t,e,s)=>s*(e-t)+t),hlp.constrain=((t,e,s)=>hlp.max(hlp.min(t,s),e)),hlp.random=((t,e)=>(null==e&&(e=t,t=0),Math.random()*(t-e)+e)),hlp.randInt=((t,e)=>(null==e&&(e=t,t=0),hlp.floor(hlp.random(t,e+1)))),hlp.dist=((...t)=>4==t.length?hlp.hypot(t[2]-t[0],t[3]-t[1]):6==t.length?hlp.hypot(t[3]-t[0],t[4]-t[1],t[5]-t[2]):void 0),hlp.randomGaussian=((t=0,e=1)=>{let s,r,i,o;if(hlp._gaussianPrev)s=hlp._y2Guass,hlp._gaussianPrev=!1;else{do{o=(r=hlp.random(0,2)-1)*r+(i=hlp.random(0,2)-1)*i}while(o>=1);s=r*(o=hlp.sqrt(-2*hlp.log(o)/o)),hlp._y2Guass=i*o,hlp._gaussianPrev=!0}return s*e+t}),hlp.RendererGL=class{constructor(t){if(this.canvas=t,this._doFill=!0,this._doStroke=!0,this._prevStates=[],this.gl=t.getContext("webgl"),this.gl||(console.warn("WebGL context not supported, falling back on experimental."),this.gl=t.getContext("experimental-webgl")),!this.gl)return alert("Browser does not support WebGL!")}},hlp.Colour=class{constructor(t,e,s,r=255,i=hlp.RGB){this.colourMode=i,this.a=255,this.set(t,e,s)}set(t,e=this.c1,s=this.c1,r){this.c1=t,this.c2=e,this.c3=s,"a"===this.colourMode.substr(-1)&&(this.a=r||255)}toString(){return hlp.Colour.toString(this.c1,this.c2,this.c3,this.a,this.colourMode)}static toString(t,e=t,s=t,r=255,i=hlp.RBG){if(i===hlp.RBG)return`rgb(${t}, ${e}, ${s}, ${r})`}},hlp.Canvas=class{constructor(t,e,s=hlp.hlp2D){if(t===hlp.FULL?(null!=e&&(this.aspectRatio=e),this.isFull=!0,this._resizeFull()):(this.width=t||400,this.height=e||400,this.aspectRatio=this.height/this.width),this.canvas=document.createElement("canvas"),this.canvas.classList.add("hlpDefaultCanvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock,s==hlp.hlp2D)this._renderer=new hlp.Renderer2D(this.canvas);else{if(s!=hlp.hlpWEBGL)return console.error("Unknown renderer!");this._renderer=new hlp.RendererGL(this.canvas)}document.body.appendChild(this.canvas),this.isFull&&window.addEventListener("resize",t=>{this._resizeFull()}),this.mouse=new hlp.Vector(0,0),this.mouseMovement=new hlp.Vector(0,0),document.body.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.mouse.set(t.clientX-e.left,t.clientY-e.top),this.mouseMovement.set(t.movementX,t.movementY)})}fill(t,e,s,r){"string"==typeof t?this._renderer.fill(t):t instanceof hlp.Colour?this._renderer.fill(t.toString()):this._renderer.fill(hlp.Colour.toString(t,e,s,r))}stroke(t,e,s,r){"string"==typeof t?this._renderer.stroke(t):t instanceof hlp.Colour?this._renderer.stroke(t.toString()):this._renderer.stroke(hlp.Colour.toString(t,e,s,r))}noFill(){this._renderer.noFill()}noStroke(){this._renderer.noStroke()}strokeWeight(t){this._renderer.strokeWeight(t)}beginShape(){this._renderer.beginShape()}endShape(t=!0){if(!this._renderer._firstPosShape._using)throw new Error("Cannot close shape before beggining!");this._renderer.endShape(t),this._renderer._firstPosShape._using=!1}vertex(t,e){t instanceof hlp.Vector?this._renderer.vertex(t.x,t.y):this._renderer.vertex(t,e)}rect(t,e,s,r){t instanceof hlp.Vector?this._renderer.rect(t.x,t.y,e,s):this._renderer.rect(t,e,s,r)}image(t,e,s,r=t.width,i=t.height){e instanceof hlp.Vector?this._renderer.image(t,e.x,e.y,s,r):this._renderer.image(t,e,s,r,i)}triangle(t,e,s,r,i,o){t instanceof hlp.Vector?this._renderer.triangle(t.x,t.y,e.x,e.y,s.x,s.y):this._renderer.triangle(t,e,s,r,i,o)}triangleInflate(t,e,s,r=1,i,o,n=1){t instanceof hlp.Vector?this._renderer.triangleInflate(t,e,s,r):this._renderer.triangleInflate(new Vector(t,e),new Vector(s,r),new Vector(i,o),n)}point(t,e){t instanceof hlp.Vector?this._renderer.point(t.x,t.y):this._renderer.point(t,e)}line(t,e,s,r){t instanceof hlp.Vector?this._renderer.line(t.x,t.y,e.x,e.y):this._renderer.line(t,e,s,r)}background(...t){this.push(),this.fill(...t),this.noStroke(),this._renderer.background(),this.pop()}translate(t,e=0){t instanceof hlp.Vector?this._renderer.translate(t.x,t.y):this._renderer.translate(t,e)}rotate(t){this._renderer.rotate(hlp.toRadians(t))}scale(t,e=0){t instanceof hlp.Vector?this._renderer.scale(t.x,t.y):this._renderer.scale(t,e)}push(){this._renderer.push()}pop(){this._renderer.pop()}text(t,e,s){e instanceof hlp.Vector?this._renderer.text(t,e.x,e.y):this._renderer.text(t,e,s)}textFont(t){this._renderer.textFont(t)}textSize(t){this._renderer.textSize(t)}textAlign(t){this._renderer.textAlign(t)}lockMouse(){this.canvas.requestPointerLock()}resizeCanvas(t,e){this.isFull&&(this.aspectRatio=this.height/this.width),this._renderer._rendererResize(t,e),this.width=t,this.height=e,null!=this.cavnas&&(this.canvas.width=this.width,this.canvas.height=this.height)}_resizeFull(){let t=innerHeight;if(null!=this.aspectRatio){const e=innerWidth/this.aspectRatio;e<innerHeight&&(t=e)}this.resizeCanvas(null!=this.aspectRatio?t*this.aspectRatio:innerWidth,t)}remove(){document.body.removeChild(this.canvas)}},hlp.Renderer2D=class{constructor(t){return this.canvas=t,this.canvas.getContext?(this.ctx=this.canvas.getContext("2d"),null==this.ctx?alert("Browser does not support the canvas!"):(this._doFill=!0,this._doStroke=!0,this._firstPosShape=new hlp.Vector(0,0),this._firstPosShape._using=!1,this._font="Arial",this._fontSize=10,this._prevStates=[],this._cacheFill=null,this._cacheStroke=null,this.width=this.canvas.width,void(this.height=this.canvas.height))):alert("Browser does not support the canvas!")}fill(t){this._doFill=!0,t!==this._cacheFill&&(this.ctx.fillStyle=t,this._cacheFill=t)}stroke(t){this._doStroke=!0,t!==this._cacheStroke&&(this.ctx.strokeStyle=t,this._cacheStroke=t)}noFill(){this._doFill=!1}noStroke(){this._doStroke=!1}strokeWeight(t){this.ctx.lineWidth=t}beginShape(){this.ctx.beginPath()}endShape(t){t&&this.ctx.closePath(this._firstPosShape.x,this._firstPosShape.y),this._doFill&&this.ctx.fill(),this._doStroke&&this.ctx.stroke()}vertex(t,e){this._firstPosShape._using?this.ctx.lineTo(t,e):(this._firstPosShape.set(t,e),this._firstPosShape._using=!0,this.ctx.moveTo(t,e))}rect(t,e,s,r){this._doFill&&this.ctx.fillRect(t,e,s,r),this._doStroke&&this.ctx.strokeRect(t,e,s,r)}image(t,e,s,r,i){this.ctx.drawImage(t,e,s,r,i)}triangle(t,e,s,r,i,o){this.beginShape(),this.vertex(t,e),this.vertex(s,r),this.vertex(i,o),this.endShape()}triangleInflate(t,e,s,r){const i=new hlp.Vector(t.x+e.x+s.x,t.y+e.y+s.y).div(3);t=hlp.Vector.sub(t,i),e=hlp.Vector.sub(e,i),s=hlp.Vector.sub(s,i),this.triangle(t.setMag(t.mag()+r).add(i),e.setMag(e.mag()+r).add(i),s.setMag(s.mag()+r).add(i))}point(t,e){this.rect(t,e,1,1)}line(t,e,s,r){this.beginShape(),this.vertex(t,e),this.vertex(s,r),this.endShape(!1)}background(){this.rect(0,0,this.width,this.height)}translate(t,e){this.ctx.translate(t,e)}rotate(t){this.ctx.rotate(t)}scale(t,e){this.ctx.scale(t,e)}push(){this._prevStates.push({_doFill:this._doFill,_doStroke:this._doStroke,_font:this._font,_fontSize:this._fontSize}),this.ctx.save()}pop(){Object.assign(this,this._prevStates.pop()),this.ctx.restore()}text(t,e,s){this.ctx.font=`${this._fontSize}px ${this._font}`,this.ctx.fillText(t,e,s)}textFont(t){this._font=t}textSize(t){this._fontSize=t}textAlign(t){this.ctx.textAlign=t}_rendererResize(t,e){this.width=t,this.hirght=e}},hlp.loadString=(async t=>{const e=await fetch(t);return await e.text()}),hlp.loadJSON=(async t=>{const e=await fetch(t);return await e.json()}),hlp.loadImage=(t=>new Promise(e=>{const s=new Image;s.src=t,s.onload=(()=>e(s))})),hlp.loadBytes=(async t=>{const e=await fetch(t),s=await e.arrayBuffer();return new Int8Array(s)}),hlp.loadSound=(t=>new Promise(e=>{e(new Audio(t))})),hlp.loadFont=(async t=>{const e=t.split("/").pop().split(".")[0],s=new FontFace(e,`url(${t})`),r=await s.load();return document.fonts.add(r),e}),hlp.httpPost=(async(t,e,s,r={})=>{const i=await fetch(t,{method:"POST",mode:r.mode||"cors",cache:r.cache||"no-cache",credentials:r.credentials||"same-origin",headers:r.headers||{"Content-Type":"application/json"},redirect:r.redirect||"follow",referrerPolicy:r.referrerPolicy||"no-referrer",body:JSON.stringify(s)});return e==hlp.json?await i.json():e==hlp.blob?await i.blob():await i.text()}),window.addEventListener("load",()=>{document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,hlp.keyPressingDict={},hlp.keyCodePressingDict={},hlp.deltaTime=0,hlp.mouseIsLocked=!1,hlp.frameCount=0,hlp.targetFPS=60,hlp.looping=!0,hlp.fpsInterval=1e3/hlp.targetFPS,hlp.fps=0,document.addEventListener("mousemove",t=>{hlp.mouseIsLocked?hlp.lockedMouseMove():hlp.unlockedMouseMove()}),document.addEventListener("pointerlockchange",()=>hlp.mouseIsLocked=!hlp.mouseIsLocked,!1),document.addEventListener("mozpointerlockchange",()=>hlp.mouseIsLocked=!hlp.mouseIsLocked,!1),document.addEventListener("mousedown",t=>{hlp.mousePressed()}),document.addEventListener("mouseup",t=>{hlp.mouseReleased()}),document.addEventListener("keydown",t=>{hlp.keyPressingDict[t.key]=!0,hlp.keyCodePressingDict[t.code]=!0,hlp.keyPressed()}),document.addEventListener("keyup",t=>{hlp.keyPressingDict[t.key]=!1,hlp.keyCodePressingDict[t.code]=!1,hlp.keyReleased()}),hlp._draw=(()=>{hlp.looping&&requestAnimationFrame(hlp._draw);try{const t=performance.now(),e=t-hlp._timeLastFrame,s=5;e>hlp.fpsInterval-s&&(hlp.frameCount++,hlp.fps=1e3/e,hlp.deltaTime=e/1e3,hlp.draw(),hlp._timeLastFrame=t)}catch(t){hlp.looping=!1,console.error(t)}});let t=document.getElementById("hlp_loading");null!=hlp.preload?(null==t&&((t=document.createElement("p")).innerHTML="Loading...",t.id="hlp_loading",document.body.appendChild(t)),t.style.position="absolute",t.style.top="10px",t.style.left="10px"):(t=null,hlp.preload=(async()=>{})),hlp.preload().then(()=>{null!=t&&document.body.removeChild(t),null!=hlp.setup&&hlp.setup(),hlp._timeStarted=performance.now(),hlp._timeLastFrame=performance.now(),hlp.start()})}),hlp.stop=(()=>hlp.looping=!1),hlp.start=(()=>{null!=hlp.draw&&(hlp.looping=!0,requestAnimationFrame(hlp._draw))}),hlp.millis=(()=>performance.now()-hlp._timeStarted),hlp.keyIsDown=(t=>hlp.keyPressingDict[t]),hlp.keyCodeIsDown=(t=>hlp.keyCodePressingDict[t]),hlp.changeFPS=(t=>{hlp.targetFPS=t,hlp.fps=t,hlp.fpsInterval=1e3/t,hlp._timeLastFrame=performance.now()}),hlp.unlockMouse=(()=>document.exitPointerLock()),hlp.mousePressed=(()=>{}),hlp.mouseReleased=(()=>{}),hlp.mouseMove=(()=>{}),hlp.keyPressed=(()=>{}),hlp.keyReleased=(()=>{}),hlp.lockedMouseMove=(()=>{}),hlp.unlockedMouseMove=(()=>{}),hlp.Controller2D=class{constructor(t){this.canvas=t,this.bodies=[]}remove(t){const e=this.bodies[this.bodies.length-1];this.bodies[t._index]=e,e._index=t._index,this.bodies.pop()}add(t){t instanceof Array?t.forEach(t=>{this._addBody(t)}):this._addBody(t)}_addBody(t){t._index=this.bodies.length,this.bodies.push(t)}draw(){this.canvas.push(),this.bodies.forEach(t=>{t.draw(this.canvas)}),this.canvas.pop()}update(){}forEach(t){this.bodies.forEach(t)}raycast(t,e,s,r=0,i=1e4,o){const n=[],a=new hlp.Vector(t,e),h=hlp.Vector.add(a,hlp.Vector.fromAngle(s,i));return this.bodies.forEach(t=>{t.lines.forEach(e=>{const i=e.a,l=e.b,c=(i.x-l.x)*(a.y-h.y)-(i.y-l.y)*(a.x-h.x);if(0==c)return;const p=((i.x-a.x)*(a.y-h.y)-(i.y-a.y)*(a.x-h.x))/c,d=-((i.x-l.x)*(i.y-a.y)-(i.y-l.y)*(i.x-a.x))/c;if(p>0&&p<1&&d>0){const h=new hlp.Vector(i.x+p*(l.x-i.x),i.y+p*(l.y-i.y));let c=h.dist(a);if(null!=o){const t=hlp.toRadians(s)-hlp.toRadians(o);c*=hlp.cos(t)}c>=r&&n.push({distance:c,line:e,body:t,point:h})}})}),n.sort((t,e)=>t.distance-e.distance),n}},hlp.Line=class{constructor(t,e,s,r){t instanceof hlp.Vector?(this.a=t.copy(),this.b=e.copy()):(this.a=new hlp.Vector(t,e),this.b=new hlp.Vector(s,r))}},hlp.Body2D=class{constructor(t,e,s=[]){this.pos=new hlp.Vector(t,e),this.lines=s,this.lines.forEach(t=>{t.a.add(this.pos),t.b.add(this.pos)}),this.fill=new hlp.Colour(255,255,255),this.stroke=new hlp.Colour(0,0,0)}addLine(t){t.a.add(this.pos),t.b.add(this.pos),this.lines.push(t)}rotate(t){this.lines.forEach(e=>{e.a.sub(this.pos),e.b.sub(this.pos),e.a.rotate(t),e.b.rotate(t),e.a.add(this.pos),e.b.add(this.pos)})}rotateTo(t){this.lines.forEach(e=>{e.a.sub(this.pos),e.b.sub(this.pos),e.a.rotateTo(t),e.b.rotateTo(t),e.a.add(this.pos),e.b.add(this.pos)})}move(t,e){const s=new hlp.Vector(t,e),r=hlp.Vector.sub(this.pos,s);this.pos=s,this.lines.forEach(t=>{t.a.add(r),t.b.add(r)})}draw(t){t.beginShape(),t.fill(this.fill),t.stroke(this.stroke),this.lines.forEach(e=>{t.vertex(e.a.x,e.a.y)}),t.endShape()}},hlp.Rectangle2D=class extends hlp.Body2D{constructor(t,e,s,r){super(t,e),s/=2,r/=2,this.addLine(new Line(-s,-r,s,-r)),this.addLine(new Line(s,-r,s,r)),this.addLine(new Line(s,r,-s,r)),this.addLine(new Line(-s,r,-s,-r))}},hlp.Triangle2D=class extends hlp.Body2D{constructor(t,e,s,r,i,o){super(x,y,[new hlp.Line(t,e,s,r),new hlp.Line(s,r,i,o),new hlp.Line(i,o,t,e)])}},hlp.Polygon2D=class extends hlp.Body2D{constructor(t,e,s,r=s,i=3){if(super(t,e,[]),i<3)throw new Error("Cannot create shape with less than 3 detail!");const o=[];for(let n=0;n<i;n++){const a=360/i,h=t+s*Math.cos(hlp.toRadians(a*n)),l=e+r*Math.sin(hlp.toRadians(a*n));o.push(new hlp.Vector(h,l))}o.forEach((t,e)=>{this.lines.push(new hlp.Line(t,o[(e+1)%o.length]))})}},hlp.AudioSynth=class{constructor(){const t=window.AudioContext||window.webkitAudioContext;if(null==t)return alert("Your browser does not support the AudioContext!");this.context=new t,this.threads={},this._counter=0}play(t,e,s,r,i=0){null!=e&&this.setFreq(t,e),null!=r&&this.setWaveType(t,r),null!=s&&this.setVolume(t,s);const o=this.threads[t];return o.startTime=i,o.oscillator.start(o.startTime),this}stop(t,e=0,s=!1){const r=this.threads[t];this.context.currentTime,r.startTime;return s&&this.setVolume(t,1e-5,e,!0),r.oscillator.stop(this.context.currentTime+e),this}dispose(t){return delete this.threads[t],this}newThread(t=this.context.destination){const e={};return this.context.resume(),e.gain=this.context.createGain(),e.gain.connect(t),e.oscillator=this.context.createOscillator(),e.oscillator.connect(e.gain),e.compressor=this.context.createDynamicsCompressor(),e.compressor.connect(this.context.destination),e.startTime=0,this.threads[this._counter]=e,this._counter++,this._counter-1}setWaveType(t,e){return this.threads[t].oscillator.type=e,this}setFreq(t,e,s=0){const r=this.threads[t],i=this.context.currentTime+r.startTime;return r.oscillator.frequency.setTargetAtTime(e,i+s,0),this}setVolume(t,e,s=0,r=!1){const i=this.threads[t],o=this.context.currentTime+i.startTime;return r?(i.gain.gain.setValueAtTime(i.gain.gain.value,this.context.currentTime),i.gain.gain.exponentialRampToValueAtTime(e,o+s)):i.gain.gain.value=e,this}},hlp.Dictionary=class{constructor(){this.data={}}contains(t){return null!=this.data[t.toString()]}get(t){return this.data[t.toString()]}set(t,e){return this.data[t.toString()]=e,this}add(t,e){return this.data[t.toString()]=e,this}remove(t){return this.data[t.toString()]=null,this}forEach(t){Object.keys(this.data).forEach(t)}},hlp.rainbow=(()=>{[...document.querySelectorAll("*")].forEach(t=>{t.style.backgroundColor="#"+Math.floor(16777215*Math.random()).toString(16),t.style.color="#"+Math.floor(16777215*Math.random()).toString(16),t.style.borderColor="#"+Math.floor(16777215*Math.random()).toString(16)})}),hlp.rainbowSeizure=(()=>{setInterval(hlp.rainbow,1)}),hlp.sleep=(async t=>new Promise(e=>setTimeout(e,t))),hlp.UniqueIDGen=class{constructor(t=5){this.increments=new Array(t).fill(0),this.incrementPointer=0}gen(){let t="";return this.increments.forEach(e=>{t+=`${e}`}),this.increments[this.incrementPointer]++,this.incrementPointer++,this.incrementPointer>this.increments.length-1&&(this.incrementPointer=0),t}},hlp.regexEscape=(t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),hlp.smartSplit=((t,e=" ",s,r="")=>{let i=t.split(new RegExp(`${hlp.regexEscape(e)}+`,"g"));if(i.slice(-1)[0]||i.pop(),null!=s)for(let t=0;t<i.length;t++)i[t].includes(s)&&i.slice(t+1).forEach((o,n)=>{const a=o.indexOf(s);if(-1==a||o[a+1]==r);else{const s=i.slice(t,n+t+2).join(e);i.splice(t,n+2,s.replace(r,""))}});return i}),hlp.safeEscape=(t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/%/g,"&#37;")),hlp.copyToClipboard=(async t=>{if(navigator.clipboard)await navigator.clipboard.writeText(t);else{console.warn("Navigator copy not supported. Falling back on experimental.");const t=document.createElement("textarea");if(t.value=text,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),!document.execCommand("copy"))return alert("Copy fallback not sucessful!");document.body.removeChild(t)}}),hlp.shuffle=((t,e)=>{let s,r,i=(t=e?t:t.slice()).length;for(;i>1;)s=Math.random()*i|0,r=t[--i],t[i]=t[s],t[s]=r;return t}),hlp.arrayRandom=(t=>{return t[hlp.randInt(t.length)]});