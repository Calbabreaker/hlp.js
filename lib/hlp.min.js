/* 
  The hlp.js library by Calbabreaker. 
  Free to use. GPL-3.0 
*/

const hlp={FULL:0,hlp2D:1,hlpWEBGL:2,CENTER:"center",LEFT:"left",RIGHT:"right",START:"end",END:"end",Matrix:class{constructor(t=0,e=0){t instanceof Array?(this.data=t,this.rows=this.data.length,this.cols=this.data[0].length):(this.rows=t,this.cols=e,this.data=new Array(t).fill().map(()=>new Array(e).fill(0)))}static add(t,e){return new hlp.Matrix(t.rows,t.cols).add(e)}add(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,i)=>e+t.data[s][i])}if("number"==typeof t)return this.map(e=>e+t);throw new Error("Did not provide valid data for parameter toAdd!")}static sub(t,e){return new hlp.Matrix(t.rows,t.cols).sub(e)}sub(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,i)=>e-t.data[s][i])}if("number"==typeof t)return this.map(e=>e-t);throw new Error("Did not provide valid data for parameter toSub!")}static dotMult(t,e){if(t.cols!==e.rows)throw new Error("hlp.Matrix a cols must match matrix b rows!");return new hlp.Matrix(t.rows,e.cols).map((s,i,r)=>{let o=0;for(let s=0;s<t.cols;s++)o+=t.data[i][s]*e.data[s][r];return o})}static multVector(t,e){if(!(t instanceof hlp.Vector))throw new Error("vec must be a vector");if(4!=e.cols||4!=e.rows)throw new Error("matrix must have 4 cols and 4 rows!");const s=new hlp.Vector(t.x,t.y,t.z);s.x=t.x*e.get(0,0)+t.y*e.get(1,0)+t.z*e.get(2,0)+e.get(3,0),s.y=t.x*e.get(0,1)+t.y*e.get(1,1)+t.z*e.get(2,1)+e.get(3,1),s.z=t.x*e.get(0,2)+t.y*e.get(1,2)+t.z*e.get(2,2)+e.get(3,2);const i=t.x*e.get(0,3)+t.y*e.get(1,3)+t.z*e.get(2,3)+e.get(3,3);return 0!=i&&s.div(i),s}static quickInverse(t){const e=new hlp.Matrix([[t.get(0,0),t.get(1,0),t.get(2,0),0],[t.get(0,1),t.get(1,1),t.get(2,1),0],[t.get(0,2),t.get(1,2),t.get(2,2),0],[0,0,0,0]]);return e.set(3,0,-(t.get(3,0)*e.get(0,0)+t.get(3,1)*e.get(1,0)+t.get(3,2)*e.get(2,0))),e.set(3,1,-(t.get(3,0)*e.get(0,1)+t.get(3,1)*e.get(1,1)+t.get(3,2)*e.get(2,1))),e.set(3,2,-(t.get(3,0)*e.get(0,2)+t.get(3,1)*e.get(1,2)+t.get(3,2)*e.get(2,2))),e.set(3,3,1),e}static mult(t,e){return new hlp.Matrix(t.rows,t.cols).mult(e)}mult(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,i)=>e*t.data[s][i])}if("number"==typeof t)return this.map(e=>e*t);throw new Error("Did not provide valid data for parameter toMult!")}static div(t,e){return new hlp.Matrix(t.rows,t.cols).div(e)}div(t){if(t instanceof hlp.Matrix){if(this.cols!==t.cols||this.rows!==t.rows)throw new Error("Both matrixs rows and cols must match!");return this.map((e,s,i)=>e/t.data[s][i])}if("number"==typeof t)return this.map(e=>e/t);throw new Error("Did not provide valid data for parameter toDiv!")}randomize(t=0,e=1){return this.map(()=>hlp.random(t,e))}randomizeGuassian(t=0,e=1){return this.map(()=>hlp.randomGaussian(t,e))}max(){let t=0;return hlp.Matrix.map(this,e=>{e>t&&(t=e)}),t}sum(){let t=0;return hlp.Matrix.map(this,e=>t+=e),t}exp(){return this.map(hlp.exp)}floor(){return this.map(hlp.floor)}fill(t){return this.map(()=>t)}set(t,e,s){return this.data[t][e]=s,this}get(t,e){return this.data[t][e]}constrain(t,e){return this.map(s=>hlp.min(hlp.max(s,t),e))}softmax(){return this.sub(this.max()).exp(),this.div(this.sum())}map(t){for(let e=0;e<this.rows;e++)for(let s=0;s<this.cols;s++){const i=this.data[e][s];this.data[e][s]=t(i,e,s)}return this}static map(t,e){return new hlp.Matrix(t.rows,t.cols).map((s,i,r)=>e(t.data[i][r],i,r))}static transpose(t){return new hlp.Matrix(t.cols,t.rows).map((e,s,i)=>t.data[i][s])}log(){return console.table(this.data),this}copy(){return hlp.Matrix.map(this,t=>t)}toArray(t=!1){if(t){const t=[];return this.data.forEach(e=>t.push(...e)),t}return this.copy().data}static createFromVector(t){return new hlp.Matrix([[t.x],[t.y],[t.z],[0]])}toVector(){if(this.rows>=3)return new hlp.Vector(this.data[0][0],this.data[1][0],this.data[2][0]);throw new Error("hlp.Matrix cannot be converted to a vector!")}static createIdentity(){return new hlp.Matrix([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}static createRotationX(t){return new hlp.Matrix([[1,0,0,0],[0,hlp.cos(t),hlp.sin(t),0],[0,-hlp.sin(t),hlp.cos(t),0],[0,0,0,1]])}static createRotationY(t){return new hlp.Matrix([[hlp.cos(t),0,hlp.sin(t),0],[0,1,0,0],[-hlp.sin(t),0,hlp.cos(t),0],[0,0,0,1]])}static createRotationZ(t){return new hlp.Matrix([[hlp.cos(t),hlp.sin(t),0,0],[-hlp.sin(t),hlp.cos(t),0,0],[0,0,1,0],[0,0,0,1]])}static createTranslation(t,e,s){return new hlp.Matrix([[1,0,0,0],[0,1,0,0],[0,0,1,0],[t,e,s,1]])}static createProjectionOrtho(){return new hlp.Matrix([[1,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]])}static createProjectionPerspect(t,e,s,i){const r=hlp.toRadians(t);return new hlp.Matrix([[e*r,0,0,0],[0,r,0,0],[0,0,i/(i-s),1],[0,0,-i*s/(i-s),0]])}static createPointAt(t,e,s){const i=hlp.Vector.sub(e,t).normalise(),r=hlp.Vector.sub(s,hlp.Vector.mult(i,s.dotProduct(i))).normalise(),o=hlp.Vector.crossProduct(r,i);return new hlp.Matrix([[o.x,o.y,o.z],[r.x,r.y,r.z],[i.x,i.y,i.z],[t.x,t.y,t.z]])}},Vector:class{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}add(t){return t instanceof hlp.Vector?(this.x+=t.x,this.y+=t.y,this.z+=t.z):(this.x+=t,this.y+=t,this.z+=t),this}static add(t,e){return t.copy().add(e)}sub(t){return t instanceof hlp.Vector?(this.x-=t.x,this.y-=t.y,this.z-=t.z):(this.x-=t,this.y-=t,this.z-=t),this}static sub(t,e){return t.copy().sub(e)}div(t){return t instanceof hlp.Vector?(this.x/=t.x,this.y/=t.y,this.z/=t.z):(this.x/=t,this.y/=t,this.z/=t),this}static div(t,e){return t.copy().div(e)}mult(t){return t instanceof hlp.Vector?(this.x*=t.x,this.y*=t.y,this.z*=t.z):(this.x*=t,this.y*=t,this.z*=t),this}static mult(t,e){return t.copy().mult(e)}static crossProduct(t,e){const s=new hlp.Vector;return s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x,s}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new hlp.Vector(this.x,this.y,this.z)}set(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}magSq(){return this.x**2+this.y**2+this.z**2}mag(){return hlp.sqrt(this.magSq())}normalise(){const t=this.mag();return 0!==t&&this.mult(1/t),this}static normalise(t){return t.copy().normalise()}dist(t){return hlp.dist(this.x,this.y,this.z,t.x,t.y,t.z)}static dist(t,e){return t.dist(e)}setMag(t){return this.normalise().mult(t)}heading(){const t=hlp.atan2(this.y,this.x);return hlp.toDegrees(t)}rotate(t){const e=hlp.toRadians(this.heading()+t),s=this.mag();return this.x=hlp.cos(e)*s,this.y=hlp.sin(e)*s,this}rotateTo(t){const e=this.heading(),s=this.mag();return this.x=hlp.cos(e)*s,this.y=hlp.sin(e)*s,this}static fromAngle(t,e=1){return t=hlp.toRadians(t),new hlp.Vector(e*hlp.cos(t),e*hlp.sin(t),0)}static intersectPlane(t,e,s,i){const r=-(e=hlp.Vector.normalise(e)).dotProduct(t),o=s.dotProduct(e),h=(-r-o)/(i.dotProduct(e)-o);return hlp.Vector.sub(i,s).mult(h).add(s)}}};Object.getOwnPropertyNames(window.Math).forEach(t=>{hlp[t]=window.Math[t]}),hlp.TWO_PI=2*hlp.PI,hlp.FOUR_PI=4*hlp.PI,hlp.HALF_PI=hlp.PI/2,hlp.QUARTER_PI=hlp.PI/4,hlp._y2Guass=0,hlp.map=((t,e,s,i,r)=>i+(r-i)*(t-e)/(s-e)),hlp.toRadians=(t=>t*hlp.PI/180),hlp.toDegrees=(t=>t*(180/hlp.PI)),hlp.lerp=((t,e,s)=>s*(e-t)+t),hlp.constrain=((t,e,s)=>hlp.max(hlp.min(t,s),e)),hlp.random=((t,e)=>Math.random()*(t-e)+e),hlp.dist=((...t)=>4==t.length?hlp.hypot(t[2]-t[0],t[3]-t[1]):6==t.length?hlp.hypot(t[3]-t[0],t[4]-t[1],t[5]-t[2]):void 0),hlp.randomGaussian=((t=0,e=1)=>{let s,i,r,o;if(this._gaussianPrev)s=hlp._y2Guass,hlp._gaussianPrev=!1;else{do{o=(i=hlp.random(0,2)-1)*i+(r=hlp.random(0,2)-1)*r}while(o>=1);s=i*(o=hlp.sqrt(-2*hlp.log(o)/o)),hlp._y2Guass=r*o,hlp._gaussianPrev=!0}return s*e+t}),hlp.Canvas=class{constructor(t,e,s=hlp.hlp2D){if(t===hlp.FULL?(null!=e&&(this.aspectRatio=e),this.isFull=!0,this._resizeFull()):(this.width=t||400,this.height=e||400,this.aspectRatio=this.height/this.width),this.canvas=document.createElement("canvas"),this.canvas.classList.add("hlpDefaultCanvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock,s==hlp.hlp2D)this._renderer=new hlp.Renderer2D(this.canvas);else{if(s!=hlp.hlpWEBGL)return console.error("Unknown renderer!");this._renderer=new hlp.RendererGL(this.canvas)}document.body.appendChild(this.canvas),this.isFull&&window.addEventListener("resize",t=>{this._resizeFull()}),this.mouse=new hlp.Vector(0,0),this.mouseMovement=new hlp.Vector(0,0),document.body.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.mouse.set(t.clientX-e.left,t.clientY-e.top),this.mouseMovement.set(t.movementX,t.movementY)}),Object.getOwnPropertyNames(Object.getPrototypeOf(this._renderer)).filter(t=>"_"!=t[0]).forEach(t=>{this[t]=((...e)=>this._renderer[t](...e))})}lockMouse(){this.canvas.requestPointerLock()}resizeCanvas(t,e){this.isFull&&(this.aspectRatio=this.height/this.width),this._renderer._rendererResize(t,e),this.width=t,this.height=e,null!=this.cavnas&&(this.canvas.width=this.width,this.canvas.height=this.height)}_resizeFull(){let t=innerHeight;if(null!=this.aspectRatio){const e=innerWidth/this.aspectRatio;e<innerHeight&&(t=e)}this.resizeCanvas(null!=this.aspectRatio?t*this.aspectRatio:innerWidth,t)}},hlp.Renderer2D=class{constructor(t){return this.canvas=t,this.canvas.getContext?(this.ctx=this.canvas.getContext("2d"),null==this.ctx?alert("Browser does not support the canvas!"):(this._doFill=!0,this._doStroke=!0,this._firstPosShape=new hlp.Vector(0,0),this._firstPosShape._using=!1,this._font="Arial",this._fontSize=10,this._prevStates=[],this.width=this.canvas.width,void(this.height=this.canvas.height))):alert("Browser does not support the canvas!")}fill(...t){this._doFill=!0,"string"==typeof t[0]?(this.ctx.fillStyle,t[0]):t[0]instanceof hlp.Colour?this.ctx.fillStyle=`rgb(${t[0].r}, ${t[0].g}, ${t[0].b})`:1==t.length?this.ctx.fillStyle=`rgb(${t[0]}, ${t[0]}, ${t[0]})`:3==t.length?this.ctx.fillStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]})`:t.length>=4&&(this.ctx.fillStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`)}stroke(...t){this._doStroke=!0,"string"==typeof t[0]?(this.ctx.strokeStyle,t[0]):t[0]instanceof hlp.Colour?this.ctx.strokeStyle=`rgb(${t[0].r}, ${t[0].g}, ${t[0].b})`:1==t.length?this.ctx.strokeStyle=`rgb(${t[0]}, ${t[0]}, ${t[0]})`:3==t.length?this.ctx.strokeStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]})`:t.length>=4&&(this.ctx.strokeStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`)}noFill(){this._doFill=!1}noStroke(){this._doStroke=!1}strokeWeight(t){this.ctx.lineWidth=t}beginShape(){if(this._firstPosShape._using)throw new Error("Cannot begin shape before closing!");this.ctx.beginPath()}endShape(t=!0){if(!this._firstPosShape._using)throw new Error("Cannot close shape before beggining!");t&&this.ctx.closePath(this._firstPosShape.x,this._firstPosShape.y),this._doFill&&this.ctx.fill(),this._doStroke&&this.ctx.stroke(),this._firstPosShape._using=!1}vertex(t,e){t instanceof hlp.Vector&&(e=t.y,t=t.x),this._firstPosShape._using?this.ctx.lineTo(t,e):(this._firstPosShape.set(t,e),this._firstPosShape._using=!0,this.ctx.moveTo(t,e))}rect(t,e,s,i){this._doFill&&this.ctx.fillRect(t,e,s,i),this._doStroke&&this.ctx.strokeRect(t,e,s,i)}image(t,e,s,i=t.width,r=t.height){this.ctx.drawImage(t,e,s,i,r)}triangle(t,e,s,i,r,o){this.beginShape(),t instanceof hlp.Vector?(this.vertex(t),this.vertex(e),this.vertex(s)):(this.vertex(t,e),this.vertex(s,i),this.vertex(r,o)),this.endShape()}triangleInflate(t,e,s,i,r,o){let h,n,a;"number"==typeof t&&(h=new hlp.Vector(t,e),n=new hlp.Vector(s,i),a=new hlp.Vector(r,o));const l=new hlp.Vector(h.x+n.x+a.x,h.y+n.y+a.y).div(3);h=hlp.Vector.sub(h,l),n=hlp.Vector.sub(n,l),a=hlp.Vector.sub(a,l),this.triangle(h.setMag(h.mag()+1).add(l),n.setMag(n.mag()+1).add(l),a.setMag(a.mag()+1).add(l))}point(t,e){this.rect(t,e,1,1)}line(t,e,s,i){this.beginShape(),t instanceof hlp.Vector?(this.vertex(t),this.vertex(e)):(this.vertex(t,e),this.vertex(s,i)),this.endShape(!1)}background(...t){this.push(),this.fill(...t),this.noStroke(),this.rect(0,0,this.width,this.height),this.pop()}translate(t,e=0){this.ctx.translate(t,e)}rotate(t){this.ctx.rotate(hlp.toRadians(t))}scale(t,e=0){this.ctx.scale(t,e)}push(){this._prevStates.push({_doFill:this._doFill,_doStroke:this._doStroke,_font:this._font,_fontSize:this._fontSize}),this.ctx.save()}pop(){Object.assign(this,this._prevStates.pop()),this.ctx.restore()}text(t,e,s){this.ctx.font=`${this._fontSize}px ${this._font}`,this.ctx.fillText(t,e,s)}textFont(t){this._font=t}textSize(t){this._fontSize=t}textAlign(t){this.ctx.textAlign=t}_rendererResize(t,e){this.width=t,this.hirght=e}};class RendererGL{constructor(t){if(this.canvas=t,this._doFill=!0,this._doStroke=!0,this._prevStates=[],this.gl=t.getContext("webgl"),this.gl||(console.warn("WebGL context not supported, falling back on experimental."),this.gl=t.getContext("experimental-webgl")),!this.gl)return alert("Browser does not support WebGL!")}fill(...t){if(this._doFill=!0,"string"==typeof t[0])this.ctx.fillStyle,t[0];else{if("number"!=typeof t[0])throw new Error("Invalid param for fill!");if(1==t.length)this.ctx.fillStyle=`rgb(${t[0]}, ${t[0]}, ${t[0]})`;else if(3==t.length)this.ctx.fillStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]})`;else{if(!(t.length>=4))throw new Error("Invalid param for fill!");this.ctx.fillStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}}}stroke(...t){if(this._doStroke=!0,"string"==typeof t[0])this.ctx.strokeStyle,t[0];else{if("number"!=typeof t[0])throw new Error("Invalid param for stroke!");if(1==t.length)this.ctx.strokeStyle=`rgb(${t[0]}, ${t[0]}, ${t[0]})`;else if(3==t.length)this.ctx.strokeStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]})`;else{if(!(t.length>=4))throw new Error("Invalid param for stroke!");this.ctx.strokeStyle=`rgb(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}}}noFill(){this._doFill=!1}noStroke(){this._doStroke=!1}background(){}}hlp.Colour=class{constructor(t,e,s){this.r=t,this.b=e,this.g=s}set(t=this.r,e=this.b,s=this.g){this.r=t,this.b=e,this.g=s}},hlp.loadString=(async t=>{const e=await fetch(t);return await e.text()}),hlp.loadJSON=(async t=>{const e=await fetch(t);return await e.json()}),hlp.loadImage=(t=>new Promise(e=>{const s=new Image;s.src=t,s.onload=(()=>e(s))})),hlp.loadBytes=(t=>new Promise(async e=>{const s=new FileReader;s.onload=function(){const t=this.result,s=new Uint8Array(t);e(s)};const i=await hlp.loadStrings(t);s.readAsArrayBuffer(new File([i],t))})),hlp.loadSound=(t=>new Promise(e=>{e(new Audio(t))})),hlp.loadFont=(async t=>{const e=t.split("/").pop().split(".")[0],s=new FontFace(e,`url(${t})`),i=await s.load();return document.fonts.add(i),e}),window.addEventListener("load",()=>{document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,hlp.keyPressingDict={},hlp.keyCodePressingDict={},hlp._timeLastFrame=performance.now(),hlp.deltaTime=0,hlp.mouseIsLocked=!1,hlp.frameCount=0,hlp.targetFPS=60,hlp.looping=!0,hlp.fpsInterval=1e3/hlp.targetFPS,hlp.fps=0,document.addEventListener("mousemove",t=>{hlp.mouseIsLocked?hlp.lockedMouseMove():hlp.unlockedMouseMove()}),document.addEventListener("pointerlockchange",()=>hlp.mouseIsLocked=!hlp.mouseIsLocked,!1),document.addEventListener("mozpointerlockchange",()=>hlp.mouseIsLocked=!hlp.mouseIsLocked,!1),document.addEventListener("mousedown",t=>{hlp.mousePressed()}),document.addEventListener("keydown",t=>{hlp.keyPressingDict[t.key]=!0,hlp.keyCodePressingDict[t.code]=!0,hlp.keyPressed()}),document.addEventListener("keyup",t=>{hlp.keyPressingDict[t.key]=!1,hlp.keyCodePressingDict[t.code]=!1,hlp.keyReleased()}),hlp._draw=(()=>{hlp.looping&&requestAnimationFrame(hlp._draw);try{const t=performance.now(),e=t-hlp._timeLastFrame,s=5;e>hlp.fpsInterval-s&&(hlp.frameCount++,hlp.fps=1e3/e,hlp.deltaTime=e/1e3,hlp.draw(),hlp._timeLastFrame=t)}catch(t){hlp.looping=!1,console.error(t)}});let t=document.getElementById("hlp_loading");null==t&&((t=document.createElement("p")).innerHTML="Loading...",t.id="hlp_loading",document.body.appendChild(t)),t.style.position="absolute",t.style.top="10px",t.style.left="10px",hlp.preload().then(()=>{document.body.removeChild(t),hlp.setup(),hlp._draw()})}),hlp.stop=(()=>{hlp.looping=!1}),hlp.start=(()=>{hlp.looping=!0,requestAnimationFrame(hlp._draw)}),hlp.keyIsDown=(t=>hlp.keyPressingDict[t]),hlp.keyCodeIsDown=(t=>hlp.keyCodePressingDict[t]),hlp.changeFPS=(t=>{hlp.targetFPS=t,hlp.fps=t,hlp.fpsInterval=1e3/t,hlp._timeLastFrame=performance.now()}),hlp.unlockMouse=(()=>{document.exitPointerLock()}),hlp.setup=(()=>{}),hlp.draw=(()=>{}),hlp.preload=(async()=>{}),hlp.mousePressed=(()=>{}),hlp.mouseMove=(()=>{}),hlp.keyPressed=(()=>{}),hlp.keyReleased=(()=>{}),hlp.lockedMouseMove=(()=>{}),hlp.unlockedMouseMove=(()=>{}),hlp.Controller2D=class{constructor(t){this.canvas=t,this.bodies=[]}remove(t){const e=this.bodies[this.bodies.length-1];this.bodies[t._index]=e,e._index=t._index,this.bodies.pop()}add(t){t instanceof Array?t.forEach(t=>{this._addBody(t)}):this._addBody(t)}_addBody(t){t._index=this.bodies.length,this.bodies.push(t)}draw(){this.canvas.push(),this.bodies.forEach(t=>{t.draw(this.canvas)}),this.canvas.pop()}update(){}raycast(t,e,s,i=0,r=1e4,o){const h=[],n=new hlp.Vector(t,e),a=hlp.Vector.add(n,hlp.Vector.fromAngle(s,r));return this.bodies.forEach(t=>{t.lines.forEach(e=>{const r=e.a,l=e.b,c=(r.x-l.x)*(n.y-a.y)-(r.y-l.y)*(n.x-a.x);if(0==c)return;const p=((r.x-n.x)*(n.y-a.y)-(r.y-n.y)*(n.x-a.x))/c,d=-((r.x-l.x)*(r.y-n.y)-(r.y-l.y)*(r.x-n.x))/c;if(p>0&&p<1&&d>0){const a=new hlp.Vector(r.x+p*(l.x-r.x),r.y+p*(l.y-r.y));let c=a.dist(n);if(null!=o){const t=hlp.toRadians(s)-hlp.toRadians(o);c*=hlp.cos(t)}c>=i&&h.push({distance:c,line:e,body:t,point:a})}})}),h.sort((t,e)=>t.distance-e.distance),h}},hlp.Line=class{constructor(t,e,s,i){t instanceof hlp.Vector?(this.a=t.copy(),this.b=e.copy()):(this.a=new hlp.Vector(t,e),this.b=new hlp.Vector(s,i))}},hlp.Body2D=class{constructor(t,e,s=[]){this.pos=new hlp.Vector(t,e),this.lines=s,this.lines.forEach(t=>{t.a.add(this.pos),t.b.add(this.pos)}),this.fill=new hlp.Colour(255,255,255),this.stroke=new hlp.Colour(0,0,0)}addLine(t){t.a.add(this.pos),t.b.add(this.pos),this.lines.push(t)}rotate(t){this.lines.forEach(e=>{e.a.sub(this.pos),e.b.sub(this.pos),e.a.rotate(t),e.b.rotate(t),e.a.add(this.pos),e.b.add(this.pos)})}rotateTo(t){this.lines.forEach(e=>{e.a.sub(this.pos),e.b.sub(this.pos),e.a.rotateTo(t),e.b.rotateTo(t),e.a.add(this.pos),e.b.add(this.pos)})}move(t,e){const s=new hlp.Vector(t,e),i=hlp.Vector.sub(this.pos,s);this.pos=s,this.lines.forEach(t=>{t.a.add(i),t.b.add(i)})}draw(t){t.beginShape(),t.fill(this.fill.r,this.fill.b,this.fill.g),t.stroke(this.stroke.r,this.stroke.b,this.stroke.g),this.lines.forEach(e=>{t.vertex(e.a.x,e.a.y)}),t.endShape()}},hlp.Rectangle2D=class extends hlp.Body2D{constructor(t,e,s,i){super(t,e),s/=2,i/=2,this.addLine(new Line(-s,-i,s,-i)),this.addLine(new Line(s,-i,s,i)),this.addLine(new Line(s,i,-s,i)),this.addLine(new Line(-s,i,-s,-i))}},hlp.Triangle2D=class extends hlp.Body2D{constructor(t,e,s,i,r,o){super(x,y,[new hlp.Line(t,e,s,i),new hlp.Line(s,i,r,o),new hlp.Line(r,o,t,e)])}},hlp.Polygon2D=class extends hlp.Body2D{constructor(t,e,s,i=s,r=3){if(super(t,e,[]),r<3)throw new Error("Cannot create shape with less than 3 detail!");const o=[];for(let h=0;h<r;h++){const n=360/r,a=t+s*Math.cos(hlp.toRadians(n*h)),l=e+i*Math.sin(hlp.toRadians(n*h));o.push(new hlp.Vector(a,l))}o.forEach((t,e)=>{this.lines.push(new hlp.Line(t,o[(e+1)%o.length]))})}},hlp.Dictionary=class{constructor(){this.data={}}contains(t){return null!=this.data[t.toString()]}get(t){return this.data[t.toString()]}set(t,e){return this.data[t.toString()]=e,this}add(t,e){return this.data[t.toString()]=e,this}remove(t){return this.data[t.toString()]=null,this}forEach(t){Object.keys(this.data).forEach(t)}},hlp.regexEscape=(t=>t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")),hlp.smartSplit=((t,e=" ",s,i="")=>{let r=t.split(new RegExp(`${e}+`,"g"));if(r.slice(-1)[0]||r.pop(),null!=s)for(let t=0;t<r.length;t++)r[t].includes(s)&&r.slice(t+1).forEach((o,h)=>{const n=o.indexOf(s);if(-1==n||o[n+1]==i);else{const s=r.slice(t,h+t+2).join(e);r.splice(t,h+2,s.replace(i,""))}});return r}),hlp.safeEscape=(t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/%/g,"&#37;")),hlp.onlyContainsSpaces=(t=>!t.replace(/\s/g,"").length),hlp.copyToClipboard=(async t=>{if(navigator.clipboard)await navigator.clipboard.writeText(t);else{const t=document.createElement("textarea");if(t.value=text,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),!document.execCommand("copy"))throw new Error("Copy fallback not sucessful!");document.body.removeChild(t)}});class AudioPlayer{constructor(){const t=window.AudioContext||window.webkitAudioContext;this.context=new t,this.reset()}play(t,e,s,i=0){return this.hasResseted?(null!=t&&this.setFreq(t),null!=s&&this.setWaveType(s),null!=e&&this.setVolume(e),this.oscillator.start(i),this.hasResseted=!1,this):console.error("Make sure you reset the AudioPlayer before playing!")}stop(t=0,e=!1){return e&&(this.gain.gain.setValueAtTime(this.gain.gain.value,this.context.currentTime),this.gain.gain.exponentialRampToValueAtTime(1e-5,this.context.currentTime+t)),this.oscillator.stop(this.context.currentTime+t),this}reset(t=this.context.destination){return this.gain=this.context.createGain(),this.gain.connect(t),this.oscillator=this.context.createOscillator(),this.oscillator.connect(this.gain),this.compressor=this.context.createDynamicsCompressor(),this.compressor.connect(this.context.destination),this.hasResseted=!0,this}setWaveType(t){return this.oscillator.type=t,this}setFreq(t){this.oscillator.frequency.value=t}setVolume(t){return this.gain.gain.value=t,this}}